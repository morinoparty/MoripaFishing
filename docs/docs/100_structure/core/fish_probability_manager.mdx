---
title: ğŸ¯ Fish Probability Manager
description: é­šã¨ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã®ç¢ºç‡ã‚’å‹•çš„ã«ç®¡ç†ã™ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
---

# ğŸ¯ Fish Probability Manager

`FishProbabilityManager`ã¯ã€é­šã‚„ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã®ç¢ºç‡ã‚’å‹•çš„ã«èª¿æ•´ã§ãã‚‹æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®åŸºæœ¬ç¢ºç‡ã«åŠ ãˆã¦ã€ã‚²ãƒ¼ãƒ ä¸­ã«æ¡ä»¶ã«å¿œã˜ã¦ç¢ºç‡ã‚’ä¸Šã’ä¸‹ã’ã§ãã¾ã™ã€‚

ãªãŠã€é­šã®ç¢ºç‡ã«ã¤ã„ã¦ã¯Rarityã®ç¢ºç‡ãŒæ±‚ã‚ã‚‰ã‚ŒãŸã®ã¡ã€æ±‚ã¾ã‚‹ãŸã‚ã€é­šã®ç¢ºç‡ãŒ2å€ã«ãªã£ãŸã¨ã—ã¦ã‚‚ã€å¿…ãšã—ã‚‚é­šã®ç¢ºç‡ãŒ2å€ã«ãªã‚‹ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚

ä¾‹ã€rare: 3, epic: 2, legendary: 1 ã®å ´åˆã€rareã®ç¢ºç‡ã¯3/6=50%ã€epicã®ç¢ºç‡ã¯2/6=33.33%ã€legendaryã®ç¢ºç‡ã¯1/6=16.67%ã¨ãªã‚Šã¾ã™ã€‚
ã“ã“ã§ã€rareã«é¯–: 50, ã‚¢ã‚¸: 50ã§å­˜åœ¨ã—ãŸã¨ãã€ã‚¢ã‚¸ãŒå‡ºã‚‹ç¢ºç‡ã¯ã™ã¹ã¦ã®é­šã®ä¸­ã§è¦‹ã‚‹ã¨25%ã¨ãªã‚Šã¾ã™ã€‚
ã“ã“ã§ã€ã‚¢ã‚¸ã®ç¢ºç‡ã‚’2å€ã«ã™ã‚‹ã¨ã€ã‚¢ã‚¸ãŒå‡ºã‚‹ç¢ºç‡ã¯50%ã¨ãªã‚‹ã‚ã‘ã§ã¯ãªãã€weightãŒ100ã¨ãªã‚Šã€100/150ã§66.67% * rareã®ç¢ºç‡ã§ã‚ã‚‹50% = 33.33%ã¨ãªã‚Šã¾ã™ã€‚


## âœ¨ ä¸»ãªæ©Ÿèƒ½

### ç¢ºç‡ä¿®æ­£ã®é©ç”¨ç¯„å›²

- **Worldå˜ä½**: ç‰¹å®šã®ä¸–ç•Œå…¨ä½“ã«é©ç”¨
- **Anglerå˜ä½**: ç‰¹å®šã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«é©ç”¨  
- **Spotå˜ä½**: ç‰¹å®šã®å ´æ‰€ï¼ˆç¯„å›²ï¼‰ã«é©ç”¨
- **Rodå˜ä½**: ç‰¹å®šã®ãƒ­ãƒƒãƒ‰ã‚¿ã‚¤ãƒ—ã«é©ç”¨ï¼ˆNEW!ï¼‰

### ç¢ºç‡ä¿®æ­£ã®ç¨®é¡

```kotlin
// åŠ ç®—ä¿®æ­£: å…ƒã®ç¢ºç‡ã«å€¤ã‚’åŠ ç®—
ApplyValue(ApplyType.ADD, 5.0)

// ä¹—ç®—ä¿®æ­£: å…ƒã®ç¢ºç‡ã«å€¤ã‚’ä¹—ç®—
ApplyValue(ApplyType.MULTIPLY, 2.0) 

// å›ºå®šä¿®æ­£: å…ƒã®ç¢ºç‡ã‚’ç„¡è¦–ã—ã¦å›ºå®šå€¤ã‚’è¨­å®š
ApplyValue(ApplyType.CONSTANT, 50.0)
```

## ğŸš€ ä½¿ç”¨ä¾‹

### ãƒ¬ã‚¢ãƒªãƒ†ã‚£ç¢ºç‡ã®ä¿®æ­£

```kotlin
val fishProbabilityManager = api.getFishProbabilityManager()

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ¬ã‚¢é­šç¢ºç‡ã‚’2å€ã«ã™ã‚‹ï¼ˆ30åˆ†é–“ï¼‰
val anglerId = AnglerId("player-uuid")
val rarityId = RarityId("legendary")
val applyValue = ApplyValue(ApplyType.MULTIPLY, 2.0)
val duration = 30 * 60 * 1000L // 30åˆ†ï¼ˆãƒŸãƒªç§’ï¼‰

fishProbabilityManager.applyRarityModifierForAngler(
    anglerId, rarityId, applyValue, duration
)
```

### ç‰¹å®šé­šç¨®ã®ç¢ºç‡ä¿®æ­£

```kotlin
// ç‰¹å®šã®ã‚¹ãƒãƒƒãƒˆã§ã‚µãƒ¼ãƒ¢ãƒ³ã®å‡ºç¾ç‡ã‚’5å€ã«ã™ã‚‹
val spot = Spot(location, 50.0) // åŠå¾„50ã®ç¯„å›²
val fishId = FishId("atlantic_salmon")
val applyValue = ApplyValue(ApplyType.MULTIPLY, 5.0)

fishProbabilityManager.applyFishModifierForSpot(
    spot, fishId, applyValue
)
```

### ä¸–ç•Œå…¨ä½“ã®ç¢ºç‡ä¿®æ­£

```kotlin
// ç‰¹å®šã®ä¸–ç•Œã§ã‚¸ãƒ£ãƒ³ã‚¯é­šã®ç¢ºç‡ã‚’åŠåˆ†ã«ã™ã‚‹
val worldId = FishingWorldId("ocean_world")
val junkRarity = RarityId("junk")
val applyValue = ApplyValue(ApplyType.MULTIPLY, 0.5)

fishProbabilityManager.applyRarityModifierForWorld(
    worldId, junkRarity, applyValue
)
```

## ğŸ® ã‚¤ãƒ™ãƒ³ãƒˆé€£æºã®ä¾‹

### ğŸª é‡£ã‚Šã‚¤ãƒ™ãƒ³ãƒˆ

```kotlin
// ã‚¤ãƒ™ãƒ³ãƒˆæœŸé–“ä¸­ã€ãƒ¬ã‚¢é­šã®ç¢ºç‡ã‚’å…¨ä½“çš„ã«ä¸Šã’ã‚‹
fun startFishingEvent() {
    val legendaryRarity = RarityId("legendary")
    val epicRarity = RarityId("epic")
    
    // å…¨ä¸–ç•Œã§ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼é­šã‚’3å€
    worldManager.getWorldIdList().forEach { worldId ->
        fishProbabilityManager.applyRarityModifierForWorld(
            worldId, legendaryRarity, 
            ApplyValue(ApplyType.MULTIPLY, 3.0),
            7 * 24 * 60 * 60 * 1000L // 7æ—¥é–“
        )
    }
}
```

### ğŸ† ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç‰¹å…¸

```kotlin
// VIPãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ç‰¹åˆ¥ãªç¢ºç‡ãƒœãƒ¼ãƒŠã‚¹ã‚’ä»˜ä¸
fun grantVipBonus(playerId: AnglerId) {
    val rarities = listOf("legendary", "epic", "rare")
    
    rarities.forEach { rarity ->
        fishProbabilityManager.applyRarityModifierForAngler(
            playerId, RarityId(rarity),
            ApplyValue(ApplyType.MULTIPLY, 1.5),
            30 * 24 * 60 * 60 * 1000L // 30æ—¥é–“
        )
    }
}
```

### ğŸŒŸ ç‰¹åˆ¥ã‚¹ãƒãƒƒãƒˆ

```kotlin
// ç‰¹å®šã®å ´æ‰€ã«ã€Œå¹¸é‹ã®é‡£ã‚Šã‚¹ãƒãƒƒãƒˆã€ã‚’ä½œæˆ
fun createLuckySpot(location: Location) {
    val spot = Spot(location, 10.0) // åŠå¾„10ã®ç¯„å›²
    
    // å…¨ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã®ç¢ºç‡ã‚’2å€
    listOf("legendary", "epic", "rare").forEach { rarity ->
        fishProbabilityManager.applyRarityModifierForSpot(
            spot, RarityId(rarity),
            ApplyValue(ApplyType.MULTIPLY, 2.0)
        )
    }
}
```

## âš™ï¸ å®Ÿè£…ã®ä»•çµ„ã¿

### ç¢ºç‡è¨ˆç®—ã®æµã‚Œ

1. **åŸºæœ¬ç¢ºç‡**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å–å¾—
2. **Worldä¿®æ­£**: ä¸–ç•Œãƒ¬ãƒ™ãƒ«ã®ä¿®æ­£å€¤ã‚’é©ç”¨
3. **Anglerä¿®æ­£**: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ¬ãƒ™ãƒ«ã®ä¿®æ­£å€¤ã‚’é©ç”¨  
4. **Spotä¿®æ­£**: å ´æ‰€ãƒ¬ãƒ™ãƒ«ã®ä¿®æ­£å€¤ã‚’é©ç”¨
5. **æœ€çµ‚ç¢ºç‡**: å…¨ä¿®æ­£å€¤ã‚’é©ç”¨ã—ãŸçµæœ

### ä¿®æ­£å€¤ã®é‡è¤‡

è¤‡æ•°ã®ä¿®æ­£å€¤ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ä»¥ä¸‹ã®é †åºã§é©ç”¨ã•ã‚Œã¾ã™ï¼š

```kotlin
// ä¾‹: åŸºæœ¬ç¢ºç‡10.0ã®å ´åˆ
var weight = 10.0

// 1. Worldä¿®æ­£: Ã— 2.0 â†’ 20.0
weight *= 2.0

// 2. Anglerä¿®æ­£: + 5.0 â†’ 25.0  
weight += 5.0

// 3. Spotä¿®æ­£: Ã— 1.5 â†’ 37.5
weight *= 1.5
```

## ğŸ”§ ç®¡ç†ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### æœŸé™åˆ‡ã‚Œä¿®æ­£å€¤ã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```kotlin
// æœŸé™åˆ‡ã‚Œã®ä¿®æ­£å€¤ã‚’æ‰‹å‹•ã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
fishProbabilityManager.cleanupExpiredModifiers()
```

### ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å›ºæœ‰ä¿®æ­£å€¤ã®ã‚¯ãƒªã‚¢

```kotlin
// ç‰¹å®šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¿®æ­£å€¤ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢
fishProbabilityManager.clearAnglerModifiers(anglerId)
```

## ğŸš¨ æ³¨æ„äº‹é …

- **ç¢ºç‡ã®ä¸‹é™**: ä¿®æ­£å¾Œã®ç¢ºç‡ãŒ0æœªæº€ã«ãªã£ãŸå ´åˆã¯è‡ªå‹•çš„ã«0ã«èª¿æ•´ã•ã‚Œã¾ã™
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: å¤§é‡ã®ä¿®æ­£å€¤ã‚’é©ç”¨ã™ã‚‹å ´åˆã¯ã€å®šæœŸçš„ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’æ¨å¥¨ã—ã¾ã™
- **æ°¸ç¶šåŒ–**: ä¿®æ­£å€¤ã¯ãƒ¡ãƒ¢ãƒªä¸Šã«ã®ã¿ä¿å­˜ã•ã‚Œã€ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•æ™‚ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™

## ğŸ“Š æ–°æ©Ÿèƒ½ï¼šRodä¿®æ­£ã¨APIä»•æ§˜æ›¸

### Rodä¿®æ­£ã‚·ã‚¹ãƒ†ãƒ 

v2.0ã§è¿½åŠ ã•ã‚ŒãŸæ–°æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ãƒ­ãƒƒãƒ‰ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸç¢ºç‡ä¿®æ­£ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

```kotlin
// ãƒ­ãƒƒãƒ‰ã‚¿ã‚¤ãƒ—ã”ã¨ã®ç¢ºç‡ä¿®æ­£
fishProbabilityManager.applyRarityModifierForRod(
    rodType = "legendary",
    rarityId = RarityId("legendary"),
    applyValue = ApplyValue(ApplyType.MULTIPLY, 3.0, "Legendary Rod Bonus"),
    limit = null // æ°¸ç¶šçš„
)

fishProbabilityManager.applyFishModifierForRod(
    rodType = "speedster", 
    fishId = FishId("bluefin_tuna"),
    applyValue = ApplyValue(ApplyType.ADD, 15.0, "Speed Fishing"),
    limit = 7200000L // 2æ™‚é–“
)
```

### éšå±¤çš„ä¿®æ­£ã‚·ã‚¹ãƒ†ãƒ 

ä¿®æ­£å€¤ã®é©ç”¨é †åºãŒæ˜ç¢ºåŒ–ã•ã‚Œã¾ã—ãŸï¼š

```
åŸºæœ¬é‡ã¿ â†’ Worldä¿®æ­£ â†’ Anglerä¿®æ­£ â†’ Spotä¿®æ­£ â†’ Rodä¿®æ­£ = æœ€çµ‚é‡ã¿
```

### åŸºæœ¬é‡ã¿ç®¡ç†API

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¨APIç®¡ç†ã®çµ±åˆãŒæ”¹å–„ã•ã‚Œã¾ã—ãŸï¼š

```kotlin
// åŸºæœ¬é‡ã¿ã®è¨­å®šï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è‡ªå‹•èª­ã¿è¾¼ã¿ï¼‰
fishProbabilityManager.setBaseRarityWeight(RarityId("common"), 70.0)
fishProbabilityManager.setBaseFishWeight(FishId("salmon"), 15.0)

// åŸºæœ¬é‡ã¿ã®å–å¾—
val baseWeight = fishProbabilityManager.getBaseRarityWeight(RarityId("rare"))

// ä¿®æ­£å¾Œé‡ã¿ã®å–å¾—ï¼ˆbaseWeightãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¦ï¼‰
val modifiedWeight = fishProbabilityManager.getModifiedRarityWeight(angler, rarityId)
```

### å®Ÿéš›ã®ç¢ºç‡å¤‰åŒ–ãƒ‡ãƒ¼ã‚¿

å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆçµæœã«åŸºã¥ãç¢ºç‡å¤‰åŒ–ã®ä¾‹ï¼š

#### æ®µéšçš„ç¢ºç‡å¤‰åŒ–ï¼ˆãƒ†ã‚¹ãƒˆçµæœï¼‰
```
1. ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³: 20.18%
2. Worldä¿®æ­£(x2): 38.86%  
3. + Anglerä¿®æ­£(+5): 90.82%
4. + Spotä¿®æ­£(x1.5): 100.00%
5. + Rodä¿®æ­£(=20): 100.00%
```

#### 3å€ä¿®æ­£ã®åŠ¹æœæ¤œè¨¼
```
ä¿®æ­£å‰: 19.43% â†’ ä¿®æ­£å¾Œ: 60.18% (ç´„3.1å€)
è©¦è¡Œå›æ•°: 10,000å›ã§ã®å®Ÿæ¸¬å€¤
```

#### æ™‚é–“åˆ¶é™æ©Ÿèƒ½ã®å‹•ä½œ
```
å³åº§: 10.0 (ä¿®æ­£å€¤é©ç”¨)
100mså¾Œ: 2.0 (ä¿®æ­£å€¤æœŸé™åˆ‡ã‚Œãƒ»è‡ªå‹•å‰Šé™¤)
```

### é«˜åº¦ãªã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè£…ä¾‹

```kotlin
class AdvancedFishingEventManager(private val fishProbabilityManager: FishProbabilityManager) {
    
    // ãƒ•ãƒ«ãƒ ãƒ¼ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆRod + Spotä¿®æ­£ã®çµ„ã¿åˆã‚ã›ï¼‰
    fun startFullMoonEvent(hotSpots: List<Spot>) {
        val eventDuration = 6 * 60 * 60 * 1000L // 6æ™‚é–“
        
        // ç‰¹åˆ¥ãªé‡£ã‚Šå ´ã§ã®ãƒœãƒ¼ãƒŠã‚¹
        hotSpots.forEach { spot ->
            fishProbabilityManager.applyRarityModifierForSpot(
                spot = spot,
                rarityId = RarityId("mythic"),
                applyValue = ApplyValue(ApplyType.MULTIPLY, 10.0, "Full Moon"),
                limit = eventDuration
            )
        }
        
        // ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼ãƒ­ãƒƒãƒ‰ã®ãƒœãƒ¼ãƒŠã‚¹å¼·åŒ–
        fishProbabilityManager.applyRarityModifierForRod(
            rodType = "legendary",
            rarityId = RarityId("legendary"),
            applyValue = ApplyValue(ApplyType.MULTIPLY, 5.0, "Moon Blessing"),
            limit = eventDuration
        )
    }
    
    // ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒœãƒ¼ãƒŠã‚¹ï¼ˆæ™‚é–“çµŒéã§åŠ¹æœå¢—åŠ ï¼‰
    fun startProgressiveEvent(anglerId: AnglerId) {
        // æ®µéšçš„ã«ãƒœãƒ¼ãƒŠã‚¹ã‚’å¢—åŠ 
        val stages = listOf(
            1.2 to 900000L,   // 15åˆ†: 1.2å€
            1.5 to 1800000L,  // 30åˆ†: 1.5å€  
            2.0 to 3600000L   // 60åˆ†: 2.0å€
        )
        
        stages.forEachIndexed { index, (multiplier, delay) ->
            Timer().schedule(delay) {
                fishProbabilityManager.applyRarityModifierForAngler(
                    anglerId = anglerId,
                    rarityId = RarityId("rare"),
                    applyValue = ApplyValue(ApplyType.MULTIPLY, multiplier, "Progressive Stage ${index + 1}"),
                    limit = 3600000L // è¿½åŠ ã§1æ™‚é–“
                )
            }
        }
    }
}
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```kotlin
// å®šæœŸã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¿ã‚¹ã‚¯
class ProbabilityMaintenanceTask : Runnable {
    override fun run() {
        fishProbabilityManager.cleanupExpiredModifiers()
        
        // çµ±è¨ˆæƒ…å ±ã®å‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        val activeModifiers = getActiveModifierCount()
        logger.info("Active probability modifiers: $activeModifiers")
    }
}

// 20åˆ†ã”ã¨ã«å®Ÿè¡Œ
Bukkit.getScheduler().runTaskTimerAsynchronously(plugin, ProbabilityMaintenanceTask(), 0L, 24000L)
```

## ğŸ”— é–¢é€£ã‚·ã‚¹ãƒ†ãƒ 

- [**Fish Selection Provider**](./fish_selection_provider): ã‚ˆã‚Šé«˜åº¦ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- [**Wait Time Manager**](../fishing_manager/wait_time_manager): åŒæ§˜ã®ä¿®æ­£å€¤ã‚·ã‚¹ãƒ†ãƒ 
- [**Fishing Manager**](../fishing_manager): é‡£ã‚Šã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ç®¡ç†
- [**Rod Configuration**](../../002_commands/rod): ãƒ­ãƒƒãƒ‰è¨­å®šã‚·ã‚¹ãƒ†ãƒ 
---
title: ğŸ› ï¸ Fish Probability API Reference
description: FishProbabilityManagerã®é–‹ç™ºè€…å‘ã‘APIå®Œå…¨ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
---

# ğŸ› ï¸ Fish Probability API Reference

`FishProbabilityManager`ã®å…¨APIãƒ¡ã‚½ãƒƒãƒ‰ã¨ä½¿ç”¨ä¾‹ã‚’è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚

## ğŸ“š ç›®æ¬¡

- [åŸºæœ¬é‡ã¿ç®¡ç†](#åŸºæœ¬é‡ã¿ç®¡ç†)
- [ãƒ¬ã‚¢ãƒªãƒ†ã‚£ç¢ºç‡ä¿®æ­£](#ãƒ¬ã‚¢ãƒªãƒ†ã‚£ç¢ºç‡ä¿®æ­£) 
- [é­šç¢ºç‡ä¿®æ­£](#é­šç¢ºç‡ä¿®æ­£)
- [ä¿®æ­£å¾Œé‡ã¿ã®å–å¾—](#ä¿®æ­£å¾Œé‡ã¿ã®å–å¾—)
- [ä¿®æ­£å€¤ã®ã‚¯ãƒªã‚¢](#ä¿®æ­£å€¤ã®ã‚¯ãƒªã‚¢)
- [å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³](#å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³)

## åŸºæœ¬é‡ã¿ç®¡ç†

### setBaseRarityWeight

```kotlin
fun setBaseRarityWeight(rarityId: RarityId, baseWeight: Double)
```

ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã®åŸºæœ¬é‡ã¿ã‚’è¨­å®šã—ã¾ã™ã€‚é€šå¸¸ã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è‡ªå‹•èª­ã¿è¾¼ã¿ã•ã‚Œã¾ã™ã€‚

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `rarityId`: å¯¾è±¡ã®ãƒ¬ã‚¢ãƒªãƒ†ã‚£ID
- `baseWeight`: åŸºæœ¬é‡ã¿ï¼ˆ0.0ä»¥ä¸Šï¼‰

**ä½¿ç”¨ä¾‹:**
```kotlin
fishProbabilityManager.setBaseRarityWeight(RarityId("common"), 70.0)
fishProbabilityManager.setBaseRarityWeight(RarityId("legendary"), 0.4)
```

### setBaseFishWeight

```kotlin
fun setBaseFishWeight(fishId: FishId, baseWeight: Double)
```

é­šã®åŸºæœ¬é‡ã¿ã‚’è¨­å®šã—ã¾ã™ã€‚

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `fishId`: å¯¾è±¡ã®é­šID
- `baseWeight`: åŸºæœ¬é‡ã¿ï¼ˆ0.0ä»¥ä¸Šï¼‰

**ä½¿ç”¨ä¾‹:**
```kotlin
fishProbabilityManager.setBaseFishWeight(FishId("salmon"), 15.0)
fishProbabilityManager.setBaseFishWeight(FishId("tuna"), 8.0)
```

### getBaseRarityWeight

```kotlin
fun getBaseRarityWeight(rarityId: RarityId): Double
```

ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã®åŸºæœ¬é‡ã¿ã‚’å–å¾—ã—ã¾ã™ã€‚

**æˆ»ã‚Šå€¤:** è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯1.0

**ä½¿ç”¨ä¾‹:**
```kotlin
val baseWeight = fishProbabilityManager.getBaseRarityWeight(RarityId("rare"))
println("RareåŸºæœ¬é‡ã¿: $baseWeight")
```

### getBaseFishWeight

```kotlin
fun getBaseFishWeight(fishId: FishId): Double
```

é­šã®åŸºæœ¬é‡ã¿ã‚’å–å¾—ã—ã¾ã™ã€‚

**æˆ»ã‚Šå€¤:** è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯1.0

## ãƒ¬ã‚¢ãƒªãƒ†ã‚£ç¢ºç‡ä¿®æ­£

### applyRarityModifierForWorld

```kotlin
fun applyRarityModifierForWorld(
    worldId: FishingWorldId,
    rarityId: RarityId, 
    applyValue: ApplyValue,
    limit: Long? = null
)
```

ãƒ¯ãƒ¼ãƒ«ãƒ‰å˜ä½ã§ãƒ¬ã‚¢ãƒªãƒ†ã‚£ç¢ºç‡ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `worldId`: å¯¾è±¡ãƒ¯ãƒ¼ãƒ«ãƒ‰ID
- `rarityId`: å¯¾è±¡ãƒ¬ã‚¢ãƒªãƒ†ã‚£ID
- `applyValue`: é©ç”¨å€¤ï¼ˆApplyType + æ•°å€¤ + èª¬æ˜ï¼‰
- `limit`: æœ‰åŠ¹æœŸé™ï¼ˆãƒŸãƒªç§’ã€nullã§ç„¡æœŸé™ï¼‰

**ä½¿ç”¨ä¾‹:**
```kotlin
// ã‚¤ãƒ™ãƒ³ãƒˆãƒ¯ãƒ¼ãƒ«ãƒ‰ã§ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼5å€ï¼ˆ1æ™‚é–“ï¼‰
fishProbabilityManager.applyRarityModifierForWorld(
    worldId = FishingWorldId("event_world"),
    rarityId = RarityId("legendary"),
    applyValue = ApplyValue(ApplyType.MULTIPLY, 5.0, "Event Boost"),
    limit = 3600000L
)
```

### applyRarityModifierForAngler

```kotlin
fun applyRarityModifierForAngler(
    anglerId: AnglerId,
    rarityId: RarityId,
    applyValue: ApplyValue, 
    limit: Long? = null
)
```

ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å˜ä½ã§ãƒ¬ã‚¢ãƒªãƒ†ã‚£ç¢ºç‡ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

**ä½¿ç”¨ä¾‹:**
```kotlin
// VIPãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ãƒ¬ã‚¢é­š1.5å€ãƒœãƒ¼ãƒŠã‚¹ï¼ˆæ°¸ç¶šï¼‰
fishProbabilityManager.applyRarityModifierForAngler(
    anglerId = AnglerId(player.uniqueId),
    rarityId = RarityId("rare"),
    applyValue = ApplyValue(ApplyType.MULTIPLY, 1.5, "VIP Bonus"),
    limit = null
)
```

### applyRarityModifierForSpot

```kotlin
fun applyRarityModifierForSpot(
    spot: Spot,
    rarityId: RarityId,
    applyValue: ApplyValue,
    limit: Long? = null
)
```

ã‚¹ãƒãƒƒãƒˆå˜ä½ã§ãƒ¬ã‚¢ãƒªãƒ†ã‚£ç¢ºç‡ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

**ä½¿ç”¨ä¾‹:**
```kotlin
// ç‰¹åˆ¥ãªé‡£ã‚Šå ´ã§ãƒŸã‚·ãƒƒã‚¯10å€ï¼ˆ6æ™‚é–“ï¼‰
val hotSpot = Spot(
    location = Location(worldId, 100.0, 64.0, 200.0, 0.0, 0.0),
    radius = 25.0
)
fishProbabilityManager.applyRarityModifierForSpot(
    spot = hotSpot,
    rarityId = RarityId("mythic"),
    applyValue = ApplyValue(ApplyType.MULTIPLY, 10.0, "Hot Spot"),
    limit = 21600000L
)
```

### applyRarityModifierForRod

```kotlin
fun applyRarityModifierForRod(
    rodType: String,
    rarityId: RarityId,
    applyValue: ApplyValue,
    limit: Long? = null
)
```

ãƒ­ãƒƒãƒ‰ã‚¿ã‚¤ãƒ—å˜ä½ã§ãƒ¬ã‚¢ãƒªãƒ†ã‚£ç¢ºç‡ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

**ä½¿ç”¨ä¾‹:**
```kotlin
// ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼ãƒ­ãƒƒãƒ‰ã§ãƒ¬ã‚¸ã‚§ãƒ³ãƒ€ãƒªãƒ¼é­š3å€
fishProbabilityManager.applyRarityModifierForRod(
    rodType = "legendary",
    rarityId = RarityId("legendary"), 
    applyValue = ApplyValue(ApplyType.MULTIPLY, 3.0, "Legendary Rod"),
    limit = null
)
```

## é­šç¢ºç‡ä¿®æ­£

### applyFishModifierForWorld

```kotlin
fun applyFishModifierForWorld(
    worldId: FishingWorldId,
    fishId: FishId,
    applyValue: ApplyValue,
    limit: Long? = null
)
```

ãƒ¯ãƒ¼ãƒ«ãƒ‰å˜ä½ã§ç‰¹å®šé­šç¨®ã®ç¢ºç‡ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

**ä½¿ç”¨ä¾‹:**
```kotlin
// ã‚µãƒ¼ãƒ¢ãƒ³ãƒ¯ãƒ¼ãƒ«ãƒ‰ã§ã‚µãƒ¼ãƒ¢ãƒ³2å€
fishProbabilityManager.applyFishModifierForWorld(
    worldId = FishingWorldId("salmon_river"),
    fishId = FishId("atlantic_salmon"),
    applyValue = ApplyValue(ApplyType.MULTIPLY, 2.0, "Salmon River"),
    limit = null
)
```

### applyFishModifierForAngler

```kotlin
fun applyFishModifierForAngler(
    anglerId: AnglerId,
    fishId: FishId,
    applyValue: ApplyValue,
    limit: Long? = null
)
```

ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å˜ä½ã§ç‰¹å®šé­šç¨®ã®ç¢ºç‡ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

### applyFishModifierForSpot

```kotlin
fun applyFishModifierForSpot(
    spot: Spot,
    fishId: FishId,
    applyValue: ApplyValue,
    limit: Long? = null
)
```

ã‚¹ãƒãƒƒãƒˆå˜ä½ã§ç‰¹å®šé­šç¨®ã®ç¢ºç‡ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

### applyFishModifierForRod

```kotlin
fun applyFishModifierForRod(
    rodType: String,
    fishId: FishId,
    applyValue: ApplyValue,
    limit: Long? = null
)
```

ãƒ­ãƒƒãƒ‰ã‚¿ã‚¤ãƒ—å˜ä½ã§ç‰¹å®šé­šç¨®ã®ç¢ºç‡ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

## ä¿®æ­£å¾Œé‡ã¿ã®å–å¾—

### getModifiedRarityWeight

```kotlin
fun getModifiedRarityWeight(angler: Angler, rarityId: RarityId): Double
```

ã‚¢ãƒ³ã‚°ãƒ©ãƒ¼ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ä¿®æ­£å¾Œã®ãƒ¬ã‚¢ãƒªãƒ†ã‚£é‡ã¿ã‚’å–å¾—ã—ã¾ã™ã€‚

**æˆ»ã‚Šå€¤:** å…¨ä¿®æ­£å€¤ã‚’é©ç”¨ã—ãŸæœ€çµ‚é‡ã¿

**è¨ˆç®—é †åº:**
1. åŸºæœ¬é‡ã¿
2. Worldä¿®æ­£
3. Anglerä¿®æ­£  
4. Spotä¿®æ­£
5. Rodä¿®æ­£

**ä½¿ç”¨ä¾‹:**
```kotlin
val modifiedWeight = fishProbabilityManager.getModifiedRarityWeight(
    angler = angler,
    rarityId = RarityId("legendary")
)
println("ä¿®æ­£å¾Œé‡ã¿: $modifiedWeight")
```

### getModifiedFishWeight

```kotlin
fun getModifiedFishWeight(angler: Angler, fishId: FishId): Double
```

ã‚¢ãƒ³ã‚°ãƒ©ãƒ¼ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ä¿®æ­£å¾Œã®é­šé‡ã¿ã‚’å–å¾—ã—ã¾ã™ã€‚

## ä¿®æ­£å€¤ã®ã‚¯ãƒªã‚¢

### clearAnglerModifiers

```kotlin
fun clearAnglerModifiers(anglerId: AnglerId)
```

ç‰¹å®šãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«é©ç”¨ã•ã‚ŒãŸå…¨ä¿®æ­£å€¤ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚

**ä½¿ç”¨ä¾‹:**
```kotlin
// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã«ã‚¯ãƒªã‚¢
@EventHandler
fun onPlayerQuit(event: PlayerQuitEvent) {
    fishProbabilityManager.clearAnglerModifiers(AnglerId(event.player.uniqueId))
}
```

### cleanupExpiredModifiers

```kotlin
fun cleanupExpiredModifiers()
```

æœŸé™åˆ‡ã‚Œã®ä¿®æ­£å€¤ã‚’æ‰‹å‹•ã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¾ã™ã€‚é€šå¸¸ã¯è‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ãŒã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹èª¿æ•´æ™‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚

## å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³

```kotlin
class EventManager(private val fishProbabilityManager: FishProbabilityManager) {
    
    private val activeEvents = mutableMapOf<String, Long>()
    
    fun startEvent(eventId: String, config: EventConfig) {
        val duration = config.durationMinutes * 60 * 1000L
        
        config.rarityModifiers.forEach { (rarity, multiplier) ->
            config.worlds.forEach { worldId ->
                fishProbabilityManager.applyRarityModifierForWorld(
                    worldId = worldId,
                    rarityId = RarityId(rarity),
                    applyValue = ApplyValue(ApplyType.MULTIPLY, multiplier, eventId),
                    limit = duration
                )
            }
        }
        
        activeEvents[eventId] = System.currentTimeMillis() + duration
    }
    
    fun isEventActive(eventId: String): Boolean {
        return activeEvents[eventId]?.let { it > System.currentTimeMillis() } ?: false
    }
}
```

### ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒœãƒ¼ãƒŠã‚¹ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³

```kotlin
class PlayerBonusManager(private val fishProbabilityManager: FishProbabilityManager) {
    
    fun applyPermissionBonus(player: Player) {
        val anglerId = AnglerId(player.uniqueId)
        
        when {
            player.hasPermission("fishing.vip.platinum") -> {
                applyVipBonus(anglerId, 2.0, "Platinum VIP")
            }
            player.hasPermission("fishing.vip.gold") -> {
                applyVipBonus(anglerId, 1.5, "Gold VIP") 
            }
            player.hasPermission("fishing.vip.silver") -> {
                applyVipBonus(anglerId, 1.2, "Silver VIP")
            }
        }
    }
    
    private fun applyVipBonus(anglerId: AnglerId, multiplier: Double, tier: String) {
        listOf("legendary", "epic", "rare").forEach { rarity ->
            fishProbabilityManager.applyRarityModifierForAngler(
                anglerId = anglerId,
                rarityId = RarityId(rarity),
                applyValue = ApplyValue(ApplyType.MULTIPLY, multiplier, tier),
                limit = null // VIPæœŸé–“ä¸­æ°¸ç¶š
            )
        }
    }
}
```

### ã‚¹ãƒãƒƒãƒˆç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³

```kotlin
class FishingSpotManager(private val fishProbabilityManager: FishProbabilityManager) {
    
    data class FishingSpot(
        val name: String,
        val location: Location,
        val radius: Double,
        val bonuses: Map<String, Double>
    )
    
    fun registerSpot(spot: FishingSpot) {
        val spotObject = Spot(spot.location, spot.radius)
        
        spot.bonuses.forEach { (rarity, multiplier) ->
            fishProbabilityManager.applyRarityModifierForSpot(
                spot = spotObject,
                rarityId = RarityId(rarity),
                applyValue = ApplyValue(ApplyType.MULTIPLY, multiplier, spot.name),
                limit = null // æ°¸ç¶šçš„ãªã‚¹ãƒãƒƒãƒˆ
            )
        }
    }
    
    fun createTemporarySpot(location: Location, durationMinutes: Long) {
        val spot = Spot(location, 10.0)
        val duration = durationMinutes * 60 * 1000L
        
        fishProbabilityManager.applyRarityModifierForSpot(
            spot = spot,
            rarityId = RarityId("mythic"),
            applyValue = ApplyValue(ApplyType.MULTIPLY, 20.0, "Lucky Spot"),
            limit = duration
        )
    }
}
```

### ãƒ­ãƒƒãƒ‰ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆé€£æºãƒ‘ã‚¿ãƒ¼ãƒ³

```kotlin
class RodEnchantmentHandler(private val fishProbabilityManager: FishProbabilityManager) {
    
    fun applyEnchantmentBonuses(player: Player, rodItem: ItemStack) {
        val anglerId = AnglerId(player.uniqueId)
        val enchantments = rodItem.enchantments
        
        // Luck of the Sea
        enchantments[Enchantment.LUCK]?.let { level ->
            val multiplier = 1.0 + (level * 0.2) // ãƒ¬ãƒ™ãƒ«æ¯ã«20%å¢—åŠ 
            fishProbabilityManager.applyRarityModifierForAngler(
                anglerId = anglerId,
                rarityId = RarityId("rare"),
                applyValue = ApplyValue(ApplyType.MULTIPLY, multiplier, "Luck of the Sea $level"),
                limit = null
            )
        }
        
        // Lure
        enchantments[Enchantment.LURE]?.let { level ->
            val addValue = level * 2.0 // ãƒ¬ãƒ™ãƒ«æ¯ã«+2.0
            listOf("common", "rare").forEach { rarity ->
                fishProbabilityManager.applyRarityModifierForAngler(
                    anglerId = anglerId,
                    rarityId = RarityId(rarity),
                    applyValue = ApplyValue(ApplyType.ADD, addValue, "Lure $level"),
                    limit = null
                )
            }
        }
    }
    
    fun clearEnchantmentBonuses(player: Player) {
        fishProbabilityManager.clearAnglerModifiers(AnglerId(player.uniqueId))
    }
}
```

## ğŸ”§ ãƒ‡ãƒãƒƒã‚°ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### ä¿®æ­£å€¤ç¢ºèªç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

```kotlin
object ProbabilityDebugger {
    
    fun analyzeAngler(angler: Angler, fishProbabilityManager: FishProbabilityManager) {
        val rarities = listOf("common", "rare", "epic", "legendary", "mythic")
        
        println("=== ã‚¢ãƒ³ã‚°ãƒ©ãƒ¼ç¢ºç‡åˆ†æ ===")
        println("ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: ${angler.getAnglerUniqueId()}")
        println("ãƒ¯ãƒ¼ãƒ«ãƒ‰: ${angler.getWorld()?.getId()}")
        println("ä½ç½®: ${angler.getLocation()}")
        println("ãƒ­ãƒƒãƒ‰: ${angler.getCurrentRodConfiguration()?.rodType}")
        println()
        
        rarities.forEach { rarity ->
            val rarityId = RarityId(rarity)
            val baseWeight = fishProbabilityManager.getBaseRarityWeight(rarityId)
            val modifiedWeight = fishProbabilityManager.getModifiedRarityWeight(angler, rarityId)
            val ratio = if (baseWeight > 0) modifiedWeight / baseWeight else 0.0
            
            println("$rarity: $baseWeight â†’ $modifiedWeight (${String.format("%.2f", ratio)}å€)")
        }
    }
    
    fun simulateProbability(
        angler: Angler, 
        fishProbabilityManager: FishProbabilityManager,
        trials: Int = 10000
    ) {
        val rarities = listOf("common", "rare", "epic", "legendary", "mythic")
        val weights = rarities.map { rarity ->
            RarityId(rarity) to fishProbabilityManager.getModifiedRarityWeight(angler, RarityId(rarity))
        }
        
        val totalWeight = weights.sumOf { it.second }
        
        println("=== ç¢ºç‡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ($trials å›è©¦è¡Œ) ===")
        weights.forEach { (rarityId, weight) ->
            val probability = (weight / totalWeight) * 100
            println("${rarityId.value}: ${String.format("%.2f", probability)}%")
        }
    }
}
```

ã“ã®APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’ä½¿ç”¨ã—ã¦ã€æŸ”è»Ÿã§å¼·åŠ›ãªç¢ºç‡ä¿®æ­£ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚